"""FSM state definitions and transition rules."""

from __future__ import annotations

PLAN_FLOW_STATES = {
    "PLAN_FLOW:DATA_COLLECTION",
    "PLAN_FLOW:CONFIRMATION_PENDING",
    "PLAN_FLOW:FINALIZATION",
}

PLAN_FLOW_ALLOWED_TRANSITIONS = {
    ("PLAN_FLOW:DATA_COLLECTION", "PLAN_FLOW:CONFIRMATION_PENDING"),
    ("PLAN_FLOW:CONFIRMATION_PENDING", "PLAN_FLOW:FINALIZATION"),
}

ACTIVE_CONFIRMATION_ENTRYPOINTS = {
    "ADAPTATION_FLOW",
}

ADAPTATION_FLOW_ENTRYPOINTS = {
    "ACTIVE",
    "ACTIVE_PAUSED",
}

PLAN_FLOW_ENTRYPOINTS = {
    "IDLE_ONBOARDED",
    "IDLE_FINISHED",
    "IDLE_DROPPED",
    "IDLE_PLAN_ABORTED",
    "ACTIVE",
    "ACTIVE_PAUSED",
}

IDLE_STATES = {
    "IDLE_NEW",
    "IDLE_ONBOARDED",
    "IDLE_PLAN_ABORTED",
    "IDLE_FINISHED",
    "IDLE_DROPPED",
}

ACTIVE_STATES = {
    "ACTIVE",
    "ACTIVE_CONFIRMATION",
}

ADAPTATION_STATES = {
    "ADAPTATION_FLOW",
}

PAUSE_STATES = {
    "ACTIVE_PAUSED",
}

ALLOWED_BASE_STATES = IDLE_STATES | ACTIVE_STATES | ADAPTATION_STATES | PAUSE_STATES

PREFIXED_STATES = {"PLAN_FLOW"}

FSM_ALLOWED_STATES = ALLOWED_BASE_STATES | PLAN_FLOW_STATES

PLAN_AGENT_ALLOWED_TRANSITION_SIGNALS = PLAN_FLOW_STATES | {
    "ADAPTATION_FLOW",
    "ACTIVE_CONFIRMATION",
    "ACTIVE",
    "IDLE_PLAN_ABORTED",
}
