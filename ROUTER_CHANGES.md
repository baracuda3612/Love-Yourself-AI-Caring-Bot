# –ó–º—ñ–Ω–∏ –≤ Router (–†–æ—É—Ç–µ—Ä) - –û–ø–∏—Å –¥–ª—è –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏

## üìã –û–≥–ª—è–¥

–†–æ—É—Ç–µ—Ä –ø–æ–≤–Ω—ñ—Å—Ç—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–∏–π –∑–≥—ñ–¥–Ω–æ –∑—ñ —Å—Ç—Ä–æ–≥–∏–º–∏ –≤–∏–º–æ–≥–∞–º–∏. –¢–µ–ø–µ—Ä –≤—ñ–Ω –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **–∂–æ—Ä—Å—Ç–∫—ñ –ø—Ä–∞–≤–∏–ª–∞** (hard-coded rules) –¥–ª—è –±—ñ–ª—å—à–æ—Å—Ç—ñ –≤–∏–ø–∞–¥–∫—ñ–≤, —ñ –≤–∏–∫–ª–∏–∫–∞—î LLM —Ç—ñ–ª—å–∫–∏ –¥–ª—è –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–∏—Ö –≤–∏–ø–∞–¥–∫—ñ–≤.

---

## üîß –¢–µ—Ö–Ω—ñ—á–Ω—ñ –∑–º—ñ–Ω–∏

### 1. –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –º–æ–¥–µ–ª—ñ

**–§–∞–π–ª:** `app/config.py`

```python
# –ë—É–ª–æ:
ROUTER_MODEL: str = "gpt-4.1-mini"
self.ROUTER_MODEL = os.getenv("ROUTER_MODEL", "gpt-4.1-mini")

# –°—Ç–∞–ª–æ:
ROUTER_MODEL: str = "gpt-5-mini"
self.ROUTER_MODEL = os.getenv("ROUTER_MODEL", "gpt-5-mini")
```

**–í —Ñ–∞–π–ª—ñ `ai_router.py`:**
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è `async_client`
- `temperature = 0` (–¥–µ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω–æ)
- `response_format={"type": "json_object"}` (—Å—Ç—Ä–æ–≥–∏–π JSON)
- –ú–æ–¥–µ–ª—å: `gpt-5-mini` (–∞–±–æ –∑ `ROUTER_MODEL` –∑–º—ñ–Ω–Ω–æ—ó)

---

### 2. –°—Ç—Ä–æ–≥–∏–π Input Payload

**–§–∞–π–ª:** `app/orchestrator.py`

–†–æ—É—Ç–µ—Ä —Ç–µ–ø–µ—Ä —á–∏—Ç–∞—î **–¢–Ü–õ–¨–ö–ò** —Ü—ñ –ø–æ–ª—è –∑ payload:
- `user_id`
- `current_state`
- `latest_user_message` (—Ä–∞–Ω—ñ—à–µ `message_text`)
- `short_term_history`

**–ë—É–ª–æ:**
```python
router_input = {
    "user_id": user_id,
    "message_text": ...,
    "short_term_history": ...,
    "profile_snapshot": ...,      # ‚ùå –í–∏–¥–∞–ª–µ–Ω–æ
    "temporal_context": ...,      # ‚ùå –í–∏–¥–∞–ª–µ–Ω–æ
}
```

**–°—Ç–∞–ª–æ:**
```python
router_input = {
    "user_id": user_id,
    "latest_user_message": ...,
    "short_term_history": ...,
    "current_state": ...,
}
```

---

### 3. –§–æ—Ä–º–∞—Ç –≤–∏–≤–æ–¥—É (Strict JSON)

**–ó–∞–≤–∂–¥–∏ –ø–æ–≤–µ—Ä—Ç–∞—î:**
```json
{
  "target_agent": "safety" | "onboarding" | "manager" | "plan" | "coach",
  "priority": "high" | "normal"
}
```

**–ü—Ä–∏ –ø–æ–º–∏–ª—Ü—ñ (parsing error, timeout, exception):**
```json
{
  "target_agent": "coach",
  "priority": "normal"
}
```

---

## üéØ –ñ–æ—Ä—Å—Ç–∫–∞ —ñ—î—Ä–∞—Ä—Ö—ñ—è –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç—ñ–≤ (Hard Rules)

–†–æ—É—Ç–µ—Ä —Å–ø–æ—á–∞—Ç–∫—É –ø–µ—Ä–µ–≤—ñ—Ä—è—î **hard-coded rules** –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º LLM.

### –ü–æ—Ä—è–¥–æ–∫ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏:

#### 1. üî• SAFETY (–ù–∞–π–≤–∏—â–∏–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç)

**–ü–µ—Ä–µ–±–∏–≤–∞—î –í–°–Ü —Å—Ç–∞–Ω–∏**, –≤–∫–ª—é—á–Ω–æ –∑ —Ç—É–Ω–µ–ª—è–º–∏.

**–û–∑–Ω–∞–∫–∏ –∫—Ä–∏–∑–∏:**
- –°—É—ó—Ü–∏–¥–∞–ª—å–Ω—ñ –¥—É–º–∫–∏: "I want to die", "kill myself", "no point living"
- –°–µ–ª—Ñ-—Ö–∞—Ä–º: "cutting", "self-harm", "hurting myself"
- –í—Ç—Ä–∞—Ç–∞ –∫–æ–Ω—Ç—Ä–æ–ª—é: "losing control", "can't control"
- –§—ñ–∑–∏—á–Ω–∞ –Ω–µ–±–µ–∑–ø–µ–∫–∞: "dangerous", "unsafe"

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{"target_agent": "safety", "priority": "high"}
```

---

#### 2. üß© FSM TUNNELS (Lock-In - –Ω–µ –º–æ–∂–Ω–∞ –ø–µ—Ä–µ—Å—Ç—Ä–∏–±–Ω—É—Ç–∏)

–Ø–∫—â–æ `current_state` —É —Ç—É–Ω–µ–ª—ñ, —Ä–æ—É—Ç–µ—Ä **–∑–∞–≤–∂–¥–∏** –ø–æ–≤–µ—Ä—Ç–∞—î –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞:

**PLAN_FLOW:**
- –Ø–∫—â–æ `current_state.startswith("PLAN_FLOW")`
- ‚Üí `{"target_agent": "plan", "priority": "normal"}`

**ADAPTATION_FLOW:**
- –Ø–∫—â–æ `current_state == "ADAPTATION_FLOW"`
- ‚Üí `{"target_agent": "plan", "priority": "normal"}`

**ONBOARDING:**
- –Ø–∫—â–æ `current_state.startswith("ONBOARDING")`
- ‚Üí `{"target_agent": "onboarding", "priority": "high"}`
- **–í–∏–Ω—è—Ç–æ–∫:** —è–∫—â–æ —î –∫—Ä–∏–∑–∞ ‚Üí safety (–ø–µ—Ä–µ–±–∏–≤–∞—î)

---

#### 3. üü¢ ACTIVE (–í—ñ–¥–∫—Ä–∏—Ç–∏–π —Å–≤—ñ—Ç)

**–Ø–∫—â–æ `current_state == "ACTIVE"`:**
- –Ø–∫—â–æ –ø—Ä–æ –ø–ª–∞–Ω/–≤–ø—Ä–∞–≤–∏/—Ä—É—Ç–∏–Ω—É ‚Üí `plan`
- –Ø–∫—â–æ –ø—Ä–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è/—É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è ‚Üí `manager`
- **–í—Å–µ —ñ–Ω—à–µ ‚Üí `coach` (HARD RULE, –±–µ–∑ LLM)**

‚ö†Ô∏è **–í–∞–∂–ª–∏–≤–æ:** LLM –ù–ï –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –¥–ª—è ACTIVE —Å—Ç–∞–Ω—É. –í—Å—ñ —Ä—ñ—à–µ–Ω–Ω—è –ø—Ä–∏–π–º–∞—é—Ç—å—Å—è –∑–∞ hard-coded –ø—Ä–∞–≤–∏–ª–∞–º–∏ –¥–ª—è —Å—Ç–∞–±—ñ–ª—å–Ω–æ—Å—Ç—ñ —Ç–∞ –ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–æ—Å—Ç—ñ.

---

#### 4. ‚ö™ IDLE STATES

**IDLE_NEW:**
- –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —Ö–æ—á–µ –ø–ª–∞–Ω ‚Üí `plan`
- –Ü–Ω–∞–∫—à–µ ‚Üí `onboarding` (coach –ù–ï –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —è–∫ –¥–µ—Ñ–æ–ª—Ç)

**IDLE_FINISHED:**
- –Ø–∫—â–æ —Ö–æ—á–µ –Ω–æ–≤–∏–π –ø–ª–∞–Ω ‚Üí `plan`
- –Ü–Ω–∞–∫—à–µ ‚Üí `coach` (—Ä–µ—Ñ–ª–µ–∫—Å—ñ—è)

**IDLE_DROPPED:**
- –Ø–∫—â–æ —è–≤–Ω–æ —Ö–æ—á–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –ø–ª–∞–Ω ‚Üí `plan`
- –Ü–Ω–∞–∫—à–µ ‚Üí `coach` (–º'—è–∫–µ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è)

---

#### 5. üîß MANAGER (Admin/System)

**–î–æ–∑–≤–æ–ª–µ–Ω–æ –≤:**
- ‚úÖ `ACTIVE` - –º–æ–∂–µ –ø–µ—Ä–µ–±–∏—Ç–∏
- ‚úÖ `IDLE_NEW`, `IDLE_FINISHED`, `IDLE_DROPPED` - –º–æ–∂–µ –ø–µ—Ä–µ–±–∏—Ç–∏
- ‚úÖ `ONBOARDING` - –º–æ–∂–µ –ø–µ—Ä–µ–±–∏—Ç–∏
- ‚ùå `PLAN_FLOW` - **–ó–ê–ë–û–†–û–ù–ï–ù–û** (—Ç—É–Ω–µ–ª—å –∞—Ç–æ–º–∞—Ä–Ω–∏–π)
- ‚ùå `ADAPTATION_FLOW` - **–ó–ê–ë–û–†–û–ù–ï–ù–û** (—Ç—É–Ω–µ–ª—å –∞—Ç–æ–º–∞—Ä–Ω–∏–π)

**–û–∑–Ω–∞–∫–∏:**
- –í–∏–¥–∞–ª–µ–Ω–Ω—è –ø–ª–∞–Ω—É: "delete plan", "remove plan"
- –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–ø–æ–≤—ñ—â–µ–Ω—å: "turn off", "stop notifications", "change notification time"
- –ü—Ä–æ—Ñ—ñ–ª—å: "change profile", "edit profile"
- –î–∞–Ω—ñ: "reset data", "delete data"

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{"target_agent": "manager", "priority": "normal"}
```

‚ö†Ô∏è **–í–∞–∂–ª–∏–≤–æ:** –¢—É–Ω–µ–ª—ñ `PLAN_FLOW` —Ç–∞ `ADAPTATION_FLOW` –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è –∞—Ç–æ–º–∞—Ä–Ω–∏–º–∏. Manager –Ω–µ –º–æ–∂–µ —ó—Ö –ø–µ—Ä–µ–±–∏—Ç–∏, —â–æ–± –Ω–µ –ø–æ—Ä—É—à–∏—Ç–∏ —Å–µ–º–∞–Ω—Ç–∏–∫—É flow.

---

#### 6. ü§î AMBIGUITY (–ù–µ–≤–∏–∑–Ω–∞—á–µ–Ω—ñ—Å—Ç—å)

–Ø–∫—â–æ –∂–æ–¥–Ω–µ –ø—Ä–∞–≤–∏–ª–æ –Ω–µ —Å–ø—Ä–∞—Ü—é–≤–∞–ª–æ ‚Üí LLM –≤–∏—Ä—ñ—à—É—î.

‚ö†Ô∏è **–í–∞–∂–ª–∏–≤–æ:** LLM –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è **—Ç—ñ–ª—å–∫–∏ –¥–ª—è –¥—ñ–π—Å–Ω–æ –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–∏—Ö –≤–∏–ø–∞–¥–∫—ñ–≤**, –∫–æ–ª–∏:
- –°—Ç–∞–Ω –Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–∏–π (–Ω–µ ACTIVE, –Ω–µ IDLE, –Ω–µ —Ç—É–Ω–µ–ª—ñ)
- –ù–∞–º—ñ—Ä –Ω–µ–≤–∏–∑–Ω–∞—á–µ–Ω–∏–π (–Ω–µ safety, –Ω–µ manager, –Ω–µ plan)

**–ë—ñ–ª—å—à—ñ—Å—Ç—å –≤–∏–ø–∞–¥–∫—ñ–≤ –æ–±—Ä–æ–±–ª—è—é—Ç—å—Å—è hard rules –±–µ–∑ LLM:**
- ‚úÖ ACTIVE ‚Üí –∑–∞–≤–∂–¥–∏ hard rule (plan/manager/coach)
- ‚úÖ IDLE states ‚Üí –∑–∞–≤–∂–¥–∏ hard rule
- ‚úÖ –¢—É–Ω–µ–ª—ñ ‚Üí –∑–∞–≤–∂–¥–∏ hard rule
- ‚úÖ Safety ‚Üí –∑–∞–≤–∂–¥–∏ hard rule

---

## üìä –õ–æ–≥—ñ–∫–∞ —Ä–æ–±–æ—Ç–∏

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   –û—Ç—Ä–∏–º–∞–Ω–æ payload  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ
           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Hard-coded Rules   ‚îÇ ‚Üê –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Å–ø–æ—á–∞—Ç–∫—É
‚îÇ  (–±–µ–∑ LLM)          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ
           ‚îú‚îÄ‚îÄ‚îÄ YES ‚Üí –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ —Ä—ñ—à–µ–Ω–Ω—è (–±–µ–∑ LLM –≤–∏–∫–ª–∏–∫—É)
           ‚îÇ
           ‚îî‚îÄ‚îÄ‚îÄ NO  ‚Üí –í–∏–∫–ª–∏–∫–∞—î–º–æ LLM –¥–ª—è –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
                      ‚Üì
                LLM –∞–Ω–∞–ª—ñ–∑—É—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
                      ‚Üì
                –ü–æ–≤–µ—Ä—Ç–∞—î JSON –∑ —Ä—ñ—à–µ–Ω–Ω—è–º
```

---

## üîç –î–µ—Ç–µ–∫—Ü—ñ—è –Ω–∞–º—ñ—Ä—ñ–≤

–î–æ–¥–∞–Ω–æ —Ñ—É–Ω–∫—Ü—ñ—ó –¥–ª—è –≤–∏—è–≤–ª–µ–Ω–Ω—è –Ω–∞–º—ñ—Ä—ñ–≤:

### `_detect_safety_crisis(message, history)`
–ü–µ—Ä–µ–≤—ñ—Ä—è—î –∫–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞ –∫—Ä–∏–∑–∏ –≤ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—ñ —Ç–∞ —ñ—Å—Ç–æ—Ä—ñ—ó.

### `_detect_manager_intent(message)`
–í–∏—è–≤–ª—è—î –∑–∞–ø–∏—Ç–∏ –Ω–∞ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–æ—é/–Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è–º–∏.

### `_detect_plan_intent(message)`
–í–∏–∑–Ω–∞—á–∞—î, —á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —Ö–æ—á–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏/–∑–º—ñ–Ω–∏—Ç–∏ –ø–ª–∞–Ω —á–∏ –≤–ø—Ä–∞–≤–∏.

---

## üìù –õ–æ–≥—É–≤–∞–Ω–Ω—è

**–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è:** `log_router_decision()`

**–õ–æ–≥—É—î—Ç—å—Å—è:**
- `target_agent` - –≤–∏–±—Ä–∞–Ω–∏–π –∞–≥–µ–Ω—Ç
- `priority` - –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç
- `latency` - —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è (–º—Å)
- `llm_prompt_tokens` - —Ç–æ–∫–µ–Ω–∏ –∑–∞–ø–∏—Ç—É
- `llm_response_tokens` - —Ç–æ–∫–µ–Ω–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
- `decision_source` - "hard_rule" –∞–±–æ "llm"

---

## ‚ö†Ô∏è –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫

**–£ —Ä–∞–∑—ñ –ø–æ–º–∏–ª–∫–∏:**
- JSON parsing error
- LLM timeout
- Empty output
- –ë—É–¥—å-—è–∫–∏–π exception

**–ü–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è fallback:**
```json
{"target_agent": "coach", "priority": "normal"}
```

**+ –õ–æ–≥—É—î—Ç—å—Å—è –ø–æ–¥—ñ—è:**
```python
{
    "event_type": "router_failure",
    "status": "error",
    "error_type": "...",
    "error": "...",
    "fallback": decision
}
```

---

## üìÅ –ó–º—ñ–Ω–µ–Ω—ñ —Ñ–∞–π–ª–∏

1. **`app/ai_router.py`** - –ø–æ–≤–Ω—ñ—Å—Ç—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–∏–π
2. **`app/config.py`** - –∑–º—ñ–Ω–µ–Ω–æ –¥–µ—Ñ–æ–ª—Ç–Ω—É –º–æ–¥–µ–ª—å –Ω–∞ `gpt-5-mini`
3. **`app/orchestrator.py`** - –æ–Ω–æ–≤–ª–µ–Ω–æ payload –¥–ª—è —Ä–æ—É—Ç–µ—Ä–∞

---

## ‚úÖ Acceptance Criteria

‚úÖ –¢—É–Ω–µ–ª—ñ –Ω–µ –ø–æ—Ä—É—à—É—é—Ç—å—Å—è
‚úÖ –£ ACTIVE —Ä–æ—É—Ç–µ—Ä –Ω–µ —Å–∫–∞—á–µ –±–µ–∑ –ø—Ä–∏—á–∏–Ω–∏
‚úÖ Onboarding –Ω–µ –ø–µ—Ä–µ—Ä–∏–≤–∞—î—Ç—å—Å—è coach'–µ–º
‚úÖ IDLE –ª–æ–≥—ñ–∫–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –ø–æ–ª—ñ—Ç–∏—Ü—ñ
‚úÖ –ü–∞–¥—ñ–Ω–Ω—è LLM –Ω–µ –ª–∞–º–∞—î —Å–∏—Å—Ç–µ–º—É
‚úÖ Safety –∑–∞–≤–∂–¥–∏ –Ω–∞–π–≤–∏—â–∏–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç

---

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –Ω–∞—Å—Ç—É–ø–Ω—ñ —Å—Ü–µ–Ω–∞—Ä—ñ—ó:

1. **Safety –∫—Ä–∏–∑–∞ –≤ —Ç—É–Ω–µ–ª—ñ** ‚Üí –º–∞—î –ø–µ—Ä–µ–±–∏—Ç–∏ —Ç—É–Ω–µ–ª—å
2. **ACTIVE —Å—Ç–∞–Ω + –∑–∞–ø–∏—Ç –ø—Ä–æ –ø–ª–∞–Ω** ‚Üí `plan`
3. **IDLE_NEW –±–µ–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–∞–ø–∏—Ç—É** ‚Üí `onboarding` (–ù–ï coach)
4. **ONBOARDING —Å—Ç–∞–Ω** ‚Üí –∑–∞–≤–∂–¥–∏ `onboarding` (–∫—Ä—ñ–º –∫—Ä–∏–∑–∏)
5. **PLAN_FLOW —Å—Ç–∞–Ω** ‚Üí –∑–∞–≤–∂–¥–∏ `plan`
6. **–ü–æ–º–∏–ª–∫–∞ LLM** ‚Üí fallback –Ω–∞ `coach`

---

## üìå –í–∞–∂–ª–∏–≤–æ

- **Router –º–æ–¥–µ–ª—å –ù–ï –∑–º—ñ–Ω—é—î—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ** - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è `ROUTER_MODEL` –∞–±–æ –¥–µ—Ñ–æ–ª—Ç `gpt-5-mini`
- **Hard rules –∑–∞—Å—Ç–æ—Å–æ–≤—É—é—Ç—å—Å—è –ü–ï–†–ï–î LLM** - —Ü–µ –µ–∫–æ–Ω–æ–º–∏—Ç—å —Ç–æ–∫–µ–Ω–∏ —Ç–∞ –∑–±—ñ–ª—å—à—É—î –ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω—ñ—Å—Ç—å
- **LLM –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –¥–ª—è –¥—ñ–π—Å–Ω–æ –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–∏—Ö –≤–∏–ø–∞–¥–∫—ñ–≤** - –±—ñ–ª—å—à—ñ—Å—Ç—å —Ä—ñ—à–µ–Ω—å –ø—Ä–∏–π–º–∞—é—Ç—å—Å—è –±–µ–∑ LLM
- **ACTIVE —Å—Ç–∞–Ω - –∑–∞–≤–∂–¥–∏ hard rule** - LLM –Ω–µ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ —Ñ–ª—É–∫—Ç—É–∞—Ü—ñ–π —Ç–∞ –Ω–µ–ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–æ—Å—Ç—ñ
- **–¢—É–Ω–µ–ª—ñ –∞—Ç–æ–º–∞—Ä–Ω—ñ** - PLAN_FLOW —Ç–∞ ADAPTATION_FLOW –Ω–µ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –ø–µ—Ä–µ–±–∏—Ç—ñ manager'–æ–º, —â–æ–± –∑–±–µ—Ä–µ–≥—Ç–∏ —Å–µ–º–∞–Ω—Ç–∏–∫—É flow

